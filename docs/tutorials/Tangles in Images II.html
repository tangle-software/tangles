
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tangles in Images II &#8212; Tangles  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/Tangles in Images II';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Tangles in Images I" href="Tangles%20in%20Images%20I.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Tangles  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Tutorials
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://www.tangles-book.com">
                    Tangles Website
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/tangle-software/tangles" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Tutorials
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://www.tangles-book.com">
                    Tangles Website
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/tangle-software/tangles" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Survey%20Tangles.html">Survey Tangles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tangles%20of%20Personality%20Traits.html">Tangles of Personality Traits</a></li>
<li class="toctree-l1"><a class="reference internal" href="Point%20Cloud%20Tangles.html">Point Cloud Tangles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tangles%20in%20Images%20I.html">Tangles in Images I</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Tangles in Images II</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Tangles in Images II</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tangles-in-images-ii">
<h1>Tangles in Images II<a class="headerlink" href="#tangles-in-images-ii" title="Link to this heading">#</a></h1>
<p>(Michael Hermann)</p>
<p>In this tutorial we explore another example proposing <em>Tangles</em> for <strong>Image Segmentation</strong>. Out <a class="reference external" href="https://tangle-software.github.io/tangles/tutorials/Letters.html">first tutorial</a> on the topic  showed a very basic proof of concept, in this notebook we will see a more realistic example: We search for tangles in the famous painting of the <em>Mona Lisa</em>. The notebook is inspired by the paper <a class="reference external" href="https://www.math.uni-hamburg.de/home/diestel/papers/MonaLisa.pdf">Tangles and the Mona Lisa</a>.</p>
<p>The purpose of this notebook is a quite pragmatic one, this means we will mainly focus on the practical application of tangles to image segmentation and will not again repeat a lot of the theory. All concepts and definitions are explained in great detail in the <a class="reference external" href="https://tangles-book.com/book/">book</a>. If you like to read more about the idea to use tangles in image processing, a look at the mentioned paper is highly recommended!</p>
<p>What do we need for tangle image segmentation? As mentioned in detail in the first image segmentation tutorial, we mainly need a <em>feature set</em> and an <em>order function</em> that determines the order in which the features are to be specified by the tangle search algorithm. This notebook will show an interesting case where these two things belong strongly together: We will first choose an order function - a particularly nice one: a <em>matrix order function</em> based onlixel similarity - and use a method inspired by linear algebra to find a bunch of very interesting features - the so-called <em>spectral separations</em>. Spectral methods work surprisingly well for image segmentation and, as we will see, combine neatly with tangle analysis algorithms.</p>
<section id="the-input-image">
<h2>1. The Input Image<a class="headerlink" href="#the-input-image" title="Link to this heading">#</a></h2>
<p>Let’s start slowly and have a look at our input image:</p>
<p>The next plot shows the original image on the left and a gray scale version on the right. For simplicity, we will work with the gray scale image in this notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">skimage.color</span> <span class="kn">import</span> <span class="n">rgb2gray</span>

<span class="n">org_image</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;images/MonaLisa.png&quot;</span><span class="p">)</span>
<span class="n">gray_image</span> <span class="o">=</span> <span class="n">rgb2gray</span><span class="p">(</span><span class="n">org_image</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">org_image</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Original image&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gray_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Gray scale image&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7431a1bc999ed91d6073d8338258d178b98edcf9684c1c6523390ef6434e6e42.png" src="../_images/7431a1bc999ed91d6073d8338258d178b98edcf9684c1c6523390ef6434e6e42.png" />
</div>
</div>
</section>
<section id="an-order-function-based-on-point-similarity">
<h2>2. An Order Function Based on Point Similarity<a class="headerlink" href="#an-order-function-based-on-point-similarity" title="Link to this heading">#</a></h2>
<p>A matrix order function is an order function <span class="math notranslate nohighlight">\(\mathcal{S} \rightarrow \mathbb{R}\)</span> given by a <em>quadratic form</em> <span class="math notranslate nohighlight">\(s \mapsto f_s^T M f_s\)</span> where <span class="math notranslate nohighlight">\(f_s \in \mathbb{R}^V\)</span> is a vector representation of the feature/separation <span class="math notranslate nohighlight">\(s \in \mathcal{S}\)</span> and <span class="math notranslate nohighlight">\(M \in \mathbb{R}^{V \times V}\)</span> is a matrix encoding pairwise relations between our data points in <span class="math notranslate nohighlight">\(V\)</span>. A common way to find a matrix <span class="math notranslate nohighlight">\(M\)</span> associated with the pixels of an image is to build a <em>Laplacian matrix</em> of a <em>similarity graph</em>. A similarity graph usually is a weighted graph <span class="math notranslate nohighlight">\(G_{sim} = (V,E,W)\)</span> on the pixels <span class="math notranslate nohighlight">\(V\)</span> with edges between pixels that are sufficiently close together such that we can assume some kind of spatial relation. The weights <span class="math notranslate nohighlight">\(W: E \rightarrow \mathbb{R}\)</span>, usually positive, encode some form of likelihood that two pixels belong to the same segment of the image. The pairwise information can be arbitrarily sophisticated and the computation might involve very complex methods from computer vision and artifical intelligence, but a very basic method works quite nicely and suits best for our example: The edge weight between two spatially close pixels is the <em>pixel intensity value similarity</em> weighted inversely by the <em>distance</em> between the pixels’ location.
The details are not very interesting here - there are multiple ways to implement such a similarity graph, the tangle library contains a useful implementation for your convenience. If you are interested in the details, please consult the documentation of the functions <a class="reference external" href="https://tangle-software.github.io/tangles/reference/api/tangles.util.graph.similarity.grid_distance_graph.html">grid_distance_graph</a> and <a class="reference external" href="https://tangle-software.github.io/tangles/reference/api/tangles.util.graph.similarity.image_to_similarity_graph.html">image_to_similarity_graph</a>.</p>
<p>We first create the similarity graph. The graph is represented by its <em>adjacency matrix</em>, i.e. a matrix <span class="math notranslate nohighlight">\(A \in \mathbb{R}^{V \times V}\)</span> containing the entry <span class="math notranslate nohighlight">\(W(u,v)\)</span> if <span class="math notranslate nohighlight">\(uv\)</span> is an edge and zero otherwise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tangles.util.graph.similarity</span> <span class="kn">import</span> <span class="n">grid_distance_graph</span><span class="p">,</span> <span class="n">image_to_similarity_graph</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">image_to_similarity_graph</span><span class="p">(</span><span class="n">gray_image</span><span class="p">,</span> <span class="n">grid_distance_graph</span><span class="p">(</span><span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The edges and their weights can be visualised in a quite nice way. Such visualisations can be crucial to find meaningful parameters for the similarity computations and to debug the implementation:
(if the notebook is run in mode <code class="docutils literal notranslate"><span class="pre">matplotlib</span> <span class="pre">notebook</span></code>, the following plot is interactive)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tangles.util.ui</span> <span class="kn">import</span> <span class="n">XYPicker</span>

<span class="n">zoom_half_size</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">_</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">draw_image_zoom_picker</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">sel_xy</span><span class="p">):</span>
    <span class="n">marked_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">gray_image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sel_xy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="n">sel_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">zoom_half_size</span><span class="p">,</span> <span class="n">sel_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">zoom_half_size</span>
        <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">sel_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">zoom_half_size</span><span class="p">,</span> <span class="n">sel_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">zoom_half_size</span>
        <span class="n">marked_im</span><span class="p">[</span><span class="n">min_y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">min_x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">max_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">marked_im</span><span class="p">[</span><span class="n">max_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">min_x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">max_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">marked_im</span><span class="p">[</span><span class="n">min_y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">max_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">min_x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">marked_im</span><span class="p">[</span><span class="n">min_y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">max_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">marked_im</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">update_zoom_img</span><span class="p">(</span><span class="n">sel_x</span><span class="p">,</span> <span class="n">sel_y</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">sel_x</span><span class="p">,</span> <span class="n">sel_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sel_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">sel_y</span><span class="p">)</span>
    <span class="n">im_idx</span> <span class="o">=</span> <span class="n">sel_y</span><span class="o">*</span><span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">sel_x</span>
    <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">sel_x</span> <span class="o">-</span> <span class="n">zoom_half_size</span><span class="p">,</span> <span class="n">sel_x</span> <span class="o">+</span> <span class="n">zoom_half_size</span>
    <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="n">sel_y</span> <span class="o">-</span> <span class="n">zoom_half_size</span><span class="p">,</span> <span class="n">sel_y</span> <span class="o">+</span> <span class="n">zoom_half_size</span>
    <span class="n">sim_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">max_x</span><span class="o">-</span><span class="n">min_x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_y</span><span class="o">-</span><span class="n">min_y</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">sim_im</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">min_y</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">min_x</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">im_idx</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">j</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sim_im</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sel_x</span><span class="p">,</span> <span class="n">sel_y</span>

<span class="n">picker</span> <span class="o">=</span> <span class="n">XYPicker</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">update_zoom_img</span><span class="p">,</span> <span class="p">[</span><span class="n">zoom_half_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">zoom_half_size</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> 
                  <span class="p">[</span><span class="n">zoom_half_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">zoom_half_size</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> 
                  <span class="n">draw_custom_picker</span><span class="o">=</span><span class="n">draw_image_zoom_picker</span><span class="p">)</span>
<span class="n">picker</span><span class="o">.</span><span class="n">callback_object</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">picker</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="n">with_callback</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f73e066db83bd1eef13e9e3acd43ff0ecb1d42a3b0a7f16ebea31f011ac33095.png" src="../_images/f73e066db83bd1eef13e9e3acd43ff0ecb1d42a3b0a7f16ebea31f011ac33095.png" />
</div>
</div>
<p>The left picture allows to select a center pixel and its neighborhood, the right picture shows the weights between the center pixel and its neighbors: yellow values encode high similarities and purple values encode low similarity (or no similarity at all).</p>
<p>The most natural way to obtain a meaningful matrix order function from a similarity matrix is to create a <em>laplacian</em> of the associated graph. There are different types of laplacians of a graph, conceptually simplest is the <em>combinatorial laplacian</em> <span class="math notranslate nohighlight">\(L = D-A\)</span> with the diagonal <em>degree matrix</em> <span class="math notranslate nohighlight">\(D \in \mathbb{R}^{V \times V}\)</span>. Using this matrix, the order of a bipartition <span class="math notranslate nohighlight">\(s \in S\)</span> is proportional to the weight of the cut induced by <span class="math notranslate nohighlight">\(s\)</span> in this graph, i.e. for <span class="math notranslate nohighlight">\(s = (A, A^c)\)</span> we have
$<span class="math notranslate nohighlight">\(|s| \propto \sum_{\substack{uv \in E \\ u \in A , v \in A^c}} W(u,v)\)</span>$.</p>
<p>In practice, a slight variation of the combinatorial laplacian, the so called <em>normalized laplacian</em> <span class="math notranslate nohighlight">\(L_{norm} = D^{-\frac{1}{2}} L D^{-\frac{1}{2}}\)</span>, works a bit better. This laplacian implicitly puts an additional weight on each edge taking some kind of <em>connectivity importance</em> of the end vertices into account. The details are not extremely important, the basic correspondence between the order of a bipartition and the cut weight in a graph still applies.</p>
<p>We create the normalized laplacian <code class="docutils literal notranslate"><span class="pre">L</span></code> and a <code class="docutils literal notranslate"><span class="pre">lambda</span></code> expression implementing the order function based on this matrix <code class="docutils literal notranslate"><span class="pre">L</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tangles.util.graph</span> <span class="kn">import</span> <span class="n">normalized_laplacian</span>


<span class="n">L</span> <span class="o">=</span> <span class="n">normalized_laplacian</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">order_fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">S</span><span class="p">:</span> <span class="p">(</span><span class="n">S</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">@</span> <span class="n">S</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-features">
<h2>3. The Features<a class="headerlink" href="#the-features" title="Link to this heading">#</a></h2>
<p>Next, we need our features. As mentioned above, we want to use <em>spectral features</em> derived from the matrix <code class="docutils literal notranslate"><span class="pre">L</span></code>. The library provides a convenience function <a class="reference external" href="https://tangle-software.github.io/tangles/reference/api/tangles.separations.finding.spectral_features.html">spectral_features</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tangles.separations.finding</span> <span class="kn">import</span> <span class="n">spectral_features</span>
<span class="n">S_spec</span> <span class="o">=</span> <span class="n">spectral_features</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">return_eigenvectors</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<p>To find the spectral features, the eigenvectors corresponding to the <span class="math notranslate nohighlight">\(k=19\)</span> smallest eigenvalues are computed and for every eigenvector a feature corresponding to its positive entries is created. The first eigenvector can be discarded as its entries have constant sign. Please note, if <span class="math notranslate nohighlight">\(f \in \mathbb{R}^V\)</span> is an eigenvector corresponding to eigenvalue <span class="math notranslate nohighlight">\(\lambda\)</span>, then <span class="math notranslate nohighlight">\(-f\)</span> is one, too. Therefore, a single eigenvector delivers one of the two specifications of a potential feature, but we don’t know which, and we don’t have any reason to prefer one specification over the other.</p>
<p>A strict mathematical explanation of the meaningfulness of these features would distract us from the more interesting things, so we want to limit ourselves to a visual analysis of these features. Let’s have a look:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">S_spec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">S_spec</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\overrightarrow{{s_{{</span><span class="si">{0}</span><span class="s2">}}}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/81c0a736b04ac409352efe53cf2b5b35b3570cb0905e63bbe249d8bbfc0d8ece.png" src="../_images/81c0a736b04ac409352efe53cf2b5b35b3570cb0905e63bbe249d8bbfc0d8ece.png" />
</div>
</div>
<p>We can immediately observe two facts: The complexity of the features seems to increase with the magnitude of the eigenvalues (the features are sorted by increasing eigenvalue), and each spectral feature appears to rather have a “global” than a “local” meaning. There is not a single feature that alone makes  sense to detect local structures or segments. In contrary, every feature seems to be a combination (i.e. the supremum - a logical <em>or</em>) of multiple local features.
In the first <a class="reference external" href="https://tangle-software.github.io/tangles/tutorials/Letters.html">Image Segmentation Tutorial</a>, we proposed an interpretation of a tangle as some kind of <em>attention mechanism</em>. This interpretation is also fruitful in this example: Every tangle is a specification of these features, and we can interpret every single feature as a part of an attention mechanism. The first potential feature indicates that the attention is either on the top part or on the bottom part of the image. The second potential feature additional puts the attention either on the left part or the right part of the image. Note, that in both of these cases, the “attention border” is not simply a straight line but follows, to some extent, a region border within the image. The same applies to the higher order features but the regions of high attention are more cluttered. Nevertheless, if the “partial attentions” of the first few specifications are combined, the specification of the higher order features will further refine the region of attention. This fact illustrates that spectral features only make sense <em>in combination</em>.</p>
<p>Let’s investigsate this fact visually. We select appropriate specifications of the first three features and compute their infimum. The combined feature  <span class="math notranslate nohighlight">\(\overrightarrow{s_1} \land \overleftarrow{s_2} \land \overrightarrow{s_3}\)</span> looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sup</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">S_spec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">S_spec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">S_spec</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="n">sup</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">gray_image</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sup</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a84c0d2e0ecddec65064ccb4c1991e04da4dc2034cebc8b7adcb7a22a0a95927.png" src="../_images/a84c0d2e0ecddec65064ccb4c1991e04da4dc2034cebc8b7adcb7a22a0a95927.png" />
</div>
</div>
<p>There is another important property of spectral features that has to be taken into account: The underlying eigenvectors are orthogonal, so we can not expect the derived features to be nested. Two potential features are nested if we can find specifications that are nested as sets.
This has two effects: for reasonable agreement parameter values most specifications of the first few spectral separations can be expected to be tangles, and, if we build the closure of the set of these features under the operations <em>inversion, supremum and infimum</em> we can expect to generate a significant subset of the universe of all possible features. In other words, the spectral features have <em>strong generative power</em> in the universe of all features.</p>
<p>The first effect is not very nice: most of the tangles of the raw feature set are <em>fake tangles</em> that would not exist if our feature system <span class="math notranslate nohighlight">\(S\)</span> would contain more low order features betwixt the spectral features. The second effect is beneficial: if we want to build a rich feature system by extending a small set of features by their corners (and corners of corners), the set of the first few spectral features might be a very good starting point.</p>
<p>The problem with building corners is the number of features growing quite fast if we build corners of corners (and so on…). Therefore, it is usually a good idea to find a way to add only the corners that are really beneficial. There are a lot of heuristics to select corners, for example, we could only add <em>balanced</em> corners or only <em>low order</em> corners. These strategies can work quite well and are often worth a try, but there is an even more elegant way if our order function is <em>submodular</em>. In this case, we can resort to the theory and add the needed corners <em>while building the tangle search tree</em>. An important theorem from tangle theory states that *if we have a submodular order function on the set of all partitions <span class="math notranslate nohighlight">\(U\)</span> of <span class="math notranslate nohighlight">\(V\)</span>, then there is a tree set of partitions <span class="math notranslate nohighlight">\(T \subseteq U\)</span> that efficiently distinguishes all <em>distinguishable</em> tangles of <span class="math notranslate nohighlight">\(\overrightarrow U\)</span>. In other words, if we would have all partitions of <span class="math notranslate nohighlight">\(V\)</span> with an order less than our maximum order feature in the spectral feature system <span class="math notranslate nohighlight">\(S\)</span>, than there is a (small) set of nested features that distinguishes the maximal tangles found on the extended set of features. In praxis, we usually don’t have <em>all</em> features with an order below some bound, as these are way too many, therefore we extend our feature set by adding in every step only the corners needed to have a nested set of efficient distinguishers. This process is called <em>automatic uncrossing</em> and the tangle library provides convenient functions (<a class="reference external" href="https://tangle-software.github.io/tangles/reference/api/tangles.UncrossingSweep.html">UncrossingSweep</a>) that implements the uncrossing tangle search algorithm.</p>
<p>Let’s create our initial feature system. We give the uncrossing algorithm a head start by computing some low order corners:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tangles.convenience.convenience_features</span> <span class="kn">import</span> <span class="n">compute_corner_features</span>
<span class="kn">from</span> <span class="nn">tangles.separations</span> <span class="kn">import</span> <span class="n">FeatureSystem</span>

<span class="n">corners</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_corner_features</span><span class="p">(</span><span class="n">S_spec</span><span class="p">,</span> <span class="n">order_func</span><span class="o">=</span><span class="n">order_fun</span><span class="p">,</span> <span class="n">max_order_factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">global_max_order</span><span class="o">=</span><span class="n">order_fun</span><span class="p">(</span><span class="n">S_spec</span><span class="p">[:,</span><span class="n">S_spec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="mi">3</span><span class="p">]))</span>
<span class="n">orders</span> <span class="o">=</span> <span class="n">order_fun</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
<span class="n">corners</span><span class="p">,</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[:,</span> <span class="p">(</span><span class="n">sorting</span> <span class="o">:=</span> <span class="n">orders</span><span class="o">.</span><span class="n">argsort</span><span class="p">())],</span> <span class="n">orders</span><span class="p">[</span><span class="n">sorting</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>If you inspect the code, you see, that we have sorted the corners by order. This is not necessary for the algorithm, but it allows us to better inspect the obtained features.The next plot shows the orders of our (sorted) features and the balance, i.e. the fraction of the data points on the smaller side of each potential feature:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">orders</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;orders (normalized to [0,1])&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">((</span><span class="n">corners</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">corners</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="n">S_spec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;balance&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;feature index&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/696d1f52f27fcf22c8204ba0bd8a61af38b4c006e15d0d2c0d3ae640baaa503a.png" src="../_images/696d1f52f27fcf22c8204ba0bd8a61af38b4c006e15d0d2c0d3ae640baaa503a.png" />
</div>
</div>
<p>In general, submodular order functions have a tendency to prefer unbalanced features. Here, the balance seems to have no influence on the order function’s value.</p>
<p>Let’s have a look at the feature system we will use for our tangle search:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">corners</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">corners</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\overrightarrow{{s_{{</span><span class="si">{0}</span><span class="s2">}}}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccd263b422e23d882a696c1ac136541e2684c4d39b82f6b7743b7da5d7d34f02.png" src="../_images/ccd263b422e23d882a696c1ac136541e2684c4d39b82f6b7743b7da5d7d34f02.png" />
</div>
</div>
<p>Most of the features still look like <em>compound features</em>, this means features that capture multiple different local aspects of the image. This is not something, a human “handcrafted” feature system would look like, but it is actually a good thing for tangles: Tangles provide a method to select good combinations of multiple (possibly complex) features!</p>
<p>In theory nothing prevents us from adding more corners and maybe select the most meaningful features by hand, but we are lazy and want to let the tangles do the main part of the work :-)</p>
<p>Let’s create the separation system and go on to the tangle search…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sep_sys</span> <span class="o">=</span> <span class="n">FeatureSystem</span><span class="o">.</span><span class="n">with_array</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-tangles">
<h2>4. The Tangles<a class="headerlink" href="#the-tangles" title="Link to this heading">#</a></h2>
<p>We start with our initial feature system and extend it at every step of the search with the corners needed to obtain a nested set of distinguishing features. This nested set of features is usually called the <em>Tree of Tangles</em>. Our primary intention is to remove fake tangles but obtaining the tree of tangles will be a nice side effect.</p>
<p>We choose a quite low agreement of <code class="docutils literal notranslate"><span class="pre">1</span></code> to remove as much fake tangles as possible (even if we will not be interested in the tangles for such a low agreement):</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tangles.search</span> <span class="kn">import</span> <span class="n">UncrossingSweep</span>
<span class="kn">from</span> <span class="nn">tangles.search.progress</span> <span class="kn">import</span> <span class="n">DefaultProgressCallback</span>

<span class="n">uncrosweep</span> <span class="o">=</span> <span class="n">UncrossingSweep</span><span class="p">(</span><span class="n">sep_sys</span><span class="p">,</span> <span class="n">order_fun</span><span class="p">)</span>
<span class="n">uncrosweep</span><span class="o">.</span><span class="n">set_uncrossing_strategy_only_most_balanced_corner</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">uncrosweep</span><span class="o">.</span><span class="n">append_next_features</span><span class="p">(</span><span class="n">agreement</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">progress_callback</span><span class="o">=</span><span class="n">DefaultProgressCallback</span><span class="p">(</span><span class="n">show_info_while_running</span><span class="o">=</span><span class="kc">False</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<p>We started with a feature set of size <code class="docutils literal notranslate"><span class="pre">104</span></code> and scaled it up by a factor of nearly <code class="docutils literal notranslate"><span class="pre">10</span></code> by adding corners (and corners of corners (of corners…)…) to efficiently distinguish <code class="docutils literal notranslate"><span class="pre">1347</span></code> maximal tangles for an agreement parameter of <code class="docutils literal notranslate"><span class="pre">1</span></code>. This means, we are as close to the theoretical ideal situation of a complete feature system as we can get with the current implementation (and our choice of an initial feature system).</p>
<p>Let us proceed to the question we are most interested in: What are tangles and what parts of the image do they describe?
The next plot shows an excerpt of the <em>tangle search tree</em> and a visualisation of the tangles at different levels of this tree. Every tangle is drawn as a <em>heat map</em> where the intensity of each pixel indicates how much a pixel belongs to the structure the tangle points to.
We could look at all tangles for agreement <code class="docutils literal notranslate"><span class="pre">1</span></code> but these contain usually a lot of unwanted tangles. We choose an agreement parameter of <code class="docutils literal notranslate"><span class="pre">900</span></code> and look at all maximal tangles up to the level <code class="docutils literal notranslate"><span class="pre">500</span></code> in the tree:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tangles.analysis</span> <span class="kn">import</span> <span class="n">tangle_score</span>
<span class="kn">from</span> <span class="nn">tangles.util.tree</span> <span class="kn">import</span> <span class="n">BinTreeNetworkX</span>

<span class="n">level</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">agreement</span> <span class="o">=</span> <span class="mi">900</span>

<span class="k">def</span> <span class="nf">draw_mona_tangle</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">bin_tree_node</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="n">BinTreeNetworkX</span><span class="o">.</span><span class="n">node_attr_bin_tree_node</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">bin_tree_node</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gray_image</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1000</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_tree_node</span><span class="o">.</span><span class="n">path_from_root_indicator</span><span class="p">())[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">tangle_score</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">uncrosweep</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">sep_ids</span><span class="p">[:</span><span class="n">path</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">uncrosweep</span><span class="o">.</span><span class="n">sep_sys</span><span class="p">,</span> <span class="n">normalize_cols</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">nodes</span> <span class="o">=</span> <span class="n">uncrosweep</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">maximal_tangles</span><span class="p">(</span><span class="n">agreement</span><span class="o">=</span><span class="n">agreement</span><span class="p">,</span> <span class="n">max_level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span> <span class="n">include_splitting</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span><span class="p">)</span>
<span class="n">bintree</span> <span class="o">=</span> <span class="n">BinTreeNetworkX</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">bintree</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">draw_node_label_func</span><span class="o">=</span><span class="n">draw_mona_tangle</span><span class="p">,</span> <span class="n">draw_edge_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">node_label_size</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">edge_label_size</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span> <span class="n">draw_levels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d2407e25e31a3aab3194a96d25cba2d59169e42d8ed0639432a3431b7143b5a6.png" src="../_images/d2407e25e31a3aab3194a96d25cba2d59169e42d8ed0639432a3431b7143b5a6.png" />
</div>
</div>
<p>Interestingly, the frist detected tangles focus on the décolleté, the face and the hands. These tangles are stable until the max level, so the combination of spectral features and tangles seems to mimic a human-like attention mechanism focussing on brighter parts in the center of the image. The tangles spawned in the next levels describe the hair and a part of the ceiling. At the next splitting level the body is separated from the background and further refined into the arms and the torso. The background is split into multiple segments that correspond to more or less random brightness fluctuations in the image. It may be worth noting, that in the background the land could be separated from the ceiling, but the land part and the ceiling part can not easily be extracted from the result without looking at the details.</p>
<p>As stated before, the way we uncrossed our feature system allows us to get the Tree of Tangles for free. Let’s visualize this tree for the same tangles as in the image above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tangles.util.tree</span> <span class="kn">import</span> <span class="n">plot_tree</span>

<span class="n">tot</span> <span class="o">=</span> <span class="n">uncrosweep</span><span class="o">.</span><span class="n">create_tot</span><span class="p">(</span><span class="n">min_agreement</span><span class="o">=</span><span class="n">agreement</span><span class="p">,</span> <span class="n">max_level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">tangle_score</span><span class="p">(</span><span class="n">tot</span><span class="o">.</span><span class="n">tangle_matrix</span><span class="p">,</span> <span class="n">uncrosweep</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">sep_ids</span><span class="p">[:</span><span class="n">tot</span><span class="o">.</span><span class="n">tangle_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">uncrosweep</span><span class="o">.</span><span class="n">sep_sys</span><span class="p">,</span> <span class="n">normalize_cols</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_tot_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">show_idx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_level</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">scores</span><span class="p">[:,</span> <span class="n">node</span><span class="o">.</span><span class="n">tangle_idx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">show_idx</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_level</span><span class="p">:</span>
        <span class="n">highest_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">reduced_tangle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span> <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">reduced_tangle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="k">else</span> <span class="n">node</span><span class="o">.</span><span class="n">reduced_tangle</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">highest_dist</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">plot_tree</span><span class="p">(</span><span class="n">tot</span><span class="o">.</span><span class="n">any_node</span><span class="p">(),</span> <span class="n">search_center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_node</span><span class="o">=</span><span class="k">lambda</span> <span class="n">node</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plot_tot_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">scores</span><span class="p">),</span> <span class="n">node_size</span><span class="o">=</span><span class="p">(</span><span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">7000</span><span class="p">,</span> <span class="n">gray_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">7000</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dd688d8d7d54f1ac61f08a5e8a299104000cbb195a9f600db16e0d218e5addc6.png" src="../_images/dd688d8d7d54f1ac61f08a5e8a299104000cbb195a9f600db16e0d218e5addc6.png" />
</div>
</div>
<p>The Tree of tangles shows the global structure of the set of tangles. In the lower part, the head is separated from the remaining image. In the middle all tangles related to the background are arranged. The top part shows all tangles related to Mona Lisa’s body including the hands as a leaf at the top.</p>
<p>There might be a bit more tangles as one would expect in an ideal example. A promising post-processing step would be to combine some of the semantically related tangles to a single segment. Nevertheless, as we did not spend extraordinarily much time tweaking the feature system and the parameters, the result is quite pleasing. Tangles are able to provide a reasonable image segmentation result that could be used beneficially as a first step in a higher level image understanding pipeline.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Tangles%20in%20Images%20I.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tangles in Images I</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-input-image">1. The Input Image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-order-function-based-on-point-similarity">2. An Order Function Based on Point Similarity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-features">3. The Features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-tangles">4. The Tangles</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/tutorials/Tangles in Images II.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Tangle Software Contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>